This README file contains information on the contents of the
s6 layer.

Please see the corresponding sections below for details.


Dependencies
============

This layer depends on:

  URI: git://git.yoctoproject.org/poky
  --------  ----------------    -----------  -----------------------------------------
  branch    last tested tag     yocto tag    rev
  --------  ----------------    -----------  -----------------------------------------
  jethro    jethro-14.0.3       yocto-2.0.3  adb34b8ddcd8cc34ae7d2b1b2e4b4d291d790f56
  krogoth   krogoth-15.0.2      yocto-2.1.2  cca8dd15c8096626052f6d8d25ff1e9a606104a3
  morty     morty-16.0.0        yocto-2.2    dc8508f609974cc99606b9042bfa7f870ce80228
  --------  ----------------    -----------  -----------------------------------------

Patches
=======

Please submit patches by making a merge request on github
https://github.com:linsam/meta-s6

Maintainer: John O'Meara <john.fr.omeara@gmail.com>


Table of Contents
=================

  I. Adding the s6 layer to your build
 II. Misc
III. Building the demo images


I. Adding the s6 layer to your build
=================================================

In order to use this layer, you need to make the build system aware of
it.

Assuming the s6 layer exists at the top-level of your
yocto build tree, you can add it to the build system by adding the
location of the s6 layer to bblayers.conf, along with any
other layers needed. e.g.:

  BBLAYERS ?= " \
    /path/to/yocto/meta \
    /path/to/yocto/meta-yocto \
    /path/to/yocto/meta-yocto-bsp \
    /path/to/yocto/meta-s6 \
    "


II. Misc
========

Should work out-of-the-box if your target machine is similar to your host
(e.g. x86-64 on x86-64 or x86 on x86-64).

If you are building a cross (e.g. arm on x86-64), then skalibs won't build
directly due to not being able to guess target machine parameters. There are
two ways to fix this:

  1) Add a bbappend in your layer to provide a premade sysdeps set, and run
     skalib's configure against that sysdeps

  2) Setup Linux to execute elf files of your target via qemu-user mode. If
     you do this, you'll also need your target's ld (dynamic linker) and libc.
     Since the linker is typically named after the target (e.g.
     ld-linux-armhf.so.3) it can go directly into your /lib. The libc is more
     tricky, and you may have to play with the search path a bit. For example,
     the arm tools for raspberry pi search in /lib/neon (among many other
     subdirectories), where the x86-64 host does not, so the arm libc can go
     there. Other architectures/machines may vary.


III. Building the demo images
=============================

NOTE: The live image only builds on Jethro and Morty, but not Krogoth. See
additional notes at the end of the section

The default conf/local.conf in your project directory needs the following tweaks:

    DISTRO ?= "s6-demo"
    NOISO = "0"
    IMAGE_FSTYPES = "live"
    INITRD_IMAGE = "core-image-anopa-minimal-initramfs"
    INITRAMFS_IMAGE_BUNDLE = "1"

Then, to build, run

    bitbake core-image-anopa-minimal
    
To run the image, run:

    runqemu qemux86 core-image-anopa-minimal kvm iso

(the "kvm"  word isn't required, but does enhance the experience)


Notes for Krogoth: Krogoth doesn't build live images, but does still build a
system image. It can be run ONCE by dropping the 'iso' from the 'runqemu' line
above. It will boot, but shutting down will panic the kernel. And, it will
fail to boot the next time. This is because the example startup scripts were
written to only support booting from an initramfs (as the livecd does), and
thus they don't function correctly when in any other configuration.

I recommend upgrading to Morty or downgrading to Jethro to run the demo
itself. For integrating s6 and friends with your project, Krogoth should work
fine.
